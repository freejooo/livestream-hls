<!DOCTYPE html>
<html>
<head>
    <title>Live Stream</title>
    <link href="https://unpkg.com/video.js@7.15.0/dist/video-js.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
    <style>
        /* CSS styles */

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
        }

        #my_video_1 {
            width: 960px;
            height: 540px;
        }

        #chat-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #1f1f1f;
            padding: 10px;
            box-sizing: border-box;
        }

        #messages {
            list-style-type: none;
            margin: 0;
            padding: 0;
            overflow-y: auto;
            max-height: 200px;
        }

        #messages li {
            margin-bottom: 10px;
            word-wrap: break-word;
            white-space: pre-wrap;
            color: #fff;
        }

        #messages li span.username {
            font-weight: bold;
        }

        #chat-form {
            display: flex;
            align-items: center;
        }

        #input-username,
        #input-message,
        #captcha-text {
            padding: 5px;
            border-radius: 3px;
            border: none;
        }

        #input-username,
        #input-message {
            flex: 1;
            margin-right: 5px;
        }

        #captcha-container {
            display: flex;
            align-items: center;
            margin-right: 5px;
        }

        #captcha-img {
            margin-right: 5px;
            cursor: pointer;
        }

        #captcha-refresh {
            cursor: pointer;
            color: #aaa;
            font-size: 14px;
            margin-right: 5px;
        }

        #captcha-text {
            width: 120px;
            margin-right: 5px;
        }

        #chat-form button {
            padding: 5px 10px;
            background-color: #9147ff;
            border: none;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }

        #chat-form button:hover {
            background-color: #803eff;
        }
    </style>
    <script src="https://unpkg.com/video.js@7.15.0/dist/video.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
</head>
<body>
    <video id="my_video_1" class="video-js vjs-default-skin" controls preload="auto" data-setup='{}'>
        <source src="/hls/output.m3u8" type="application/x-mpegURL">
    </video>
    <div id="chat-container">
        <ul id="messages"></ul>
        <form id="chat-form" action="">
            <input id="input-username" autocomplete="off" placeholder="Username" required>
            <input id="input-message" autocomplete="off" placeholder="Type your message..." required>
            <div id="captcha-container">
                <img id="captcha-img" src="/captcha" alt="CAPTCHA">
                <span id="captcha-refresh">‚ü≥</span>
                <input id="captcha-text" type="text" placeholder="Enter CAPTCHA" required>
            </div>
            <button type="submit">Send</button>
        </form>
    </div>
    <script>
        // JavaScript code
// JavaScript code

const player = videojs('my_video_1');
player.play();

const socket = io();

const form = document.getElementById('chat-form');
const inputUsername = document.getElementById('input-username');
const inputMessage = document.getElementById('input-message');
const messages = document.getElementById('messages');
const captchaImg = document.getElementById('captcha-img');
const captchaRefresh = document.getElementById('captcha-refresh');
const captchaText = document.getElementById('captcha-text');

form.addEventListener('submit', (e) => {
    e.preventDefault();
    const username = inputUsername.value.trim() || 'Anonymous';
    const message = inputMessage.value.trim();
    const captcha = captchaText.value.trim();
    if (message && captcha) {
        verifyCaptcha(captcha)
            .then((isValid) => {
                if (isValid) {
                    const chatMessage = `${username}: ${message}`;
                    socket.emit('chat_message', chatMessage);
                    inputMessage.value = '';
                    captchaText.value = '';
                    refreshCaptcha();
                } else {
                    alert('Invalid CAPTCHA!');
                    refreshCaptcha();
                }
            })
            .catch((error) => {
                console.error('CAPTCHA verification failed:', error);
            });
    }
});

socket.on('chat_message', (message) => {
    const li = document.createElement('li');
    li.textContent = message;
    messages.appendChild(li);
});

captchaRefresh.addEventListener('click', refreshCaptcha);

function verifyCaptcha(captchaText) {
    return fetch('/verify_captcha', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `captcha_text=${captchaText}`,
    })
        .then((response) => response.json())
        .then((data) => data.success)
        .catch((error) => {
            console.error('CAPTCHA verification failed:', error);
            return false;
        });
}

function refreshCaptcha() {
    captchaImg.src = `/captcha?${new Date().getTime()}`;
}


    </script>
</body>
</html>
